<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../google-apis/google-legacy-loader.html">


</head><body><dom-module id="google-chart">
  <link rel="import" type="css" href="google-chart.css">
  <template>
    <iron-ajax id="ajax" handle-as="json" url="{{data}}" on-response="_externalDataLoaded"></iron-ajax>
    <div id="chartdiv"></div>
    <google-legacy-loader on-api-load="_readyForAction"></google-legacy-loader>
  </template>
</dom-module>

<script>!function(){"use strict";Polymer({is:"google-chart",properties:{type:{type:String,value:"column",observer:"_typeChanged"},options:{type:Object,value:function(){return{}}},cols:{type:Array,value:function(){return[]}},rows:{type:Array,value:function(){return[]}},data:{type:Object,value:function(){return[]}},selection:{type:Array,value:function(){return[]},observer:"_selectionChanged"}},observers:["_loadData(rows, cols, data)"],_packages:null,_chartObject:null,_isReady:!1,_canDraw:!1,_dataTable:null,_chartTypes:null,_readyForAction:function(t,a,e){this._loadPackageByChartType(),google.load("visualization","1",{packages:this._packages[this.type],callback:function(){this._isReady=!0,this._loadChartTypes(),this._loadData()}.bind(this)})},_typeChanged:function(){this._chartObject=null,this._loadData()},_selectionChanged:function(){this._chartObject&&this.setSelection&&this._chartObject.setSelection(this.selection)},drawChart:function(){if(this._canDraw){if(this.options||(this.options={}),!this._chartObject){var t=this._chartTypes[this.type];t&&(this._chartObject=new t(this.$.chartdiv))}this._chartObject?(google.visualization.events.addOneTimeListener(this._chartObject,"ready",function(){this.fire("google-chart-render")}.bind(this)),google.visualization.events.addListener(this._chartObject,"select",function(){this.selection=this._chartObject.getSelection(),this.fire("google-chart-select",{selection:this._chartObject.getSelection()})}.bind(this)),this._chartObject.draw(this._dataTable,this.options),this._chartObject.setSelection&&this._chartObject.setSelection(this.selection)):this.$.chartdiv.innerHTML="Undefined chart type"}return null},getImageURI:function(){return this._chartObject.getImageURI()},_loadChartTypes:function(){this._chartTypes={area:google.visualization.AreaChart,bar:google.visualization.BarChart,bubble:google.visualization.BubbleChart,candlestick:google.visualization.CandlestickChart,column:google.visualization.ColumnChart,combo:google.visualization.ComboChart,geo:google.visualization.GeoChart,histogram:google.visualization.Histogram,line:google.visualization.LineChart,pie:google.visualization.PieChart,scatter:google.visualization.ScatterChart,"stepped-area":google.visualization.SteppedAreaChart,table:google.visualization.Table,gauge:google.visualization.Gauge,treemap:google.visualization.TreeMap}},_loadPackageByChartType:function(){this._packages={area:"corechart",bar:"corechart",bubble:"corechart",candlestick:"corechart",column:"corechart",combo:"corechart",geo:"corechart",histogram:"corechart",line:"corechart",pie:"corechart",scatter:"corechart","stepped-area":"corechart",table:"table",gauge:"gauge",treemap:"treemap"}},_loadData:function(){if(this._canDraw=!1,this._isReady)if("string"==typeof this.data||this.data instanceof String)this.$.ajax.generateRequest();else{var t=this._createDataTable();this._canDraw=!0,t&&(this._dataTable=t,this.drawChart())}},_externalDataLoaded:function(t){var a=this._createDataTable(t.detail.response);this._canDraw=!0,this._dataTable=a,this.drawChart()},_createDataTable:function(t){var a=null;if(t||(t=this.data),t||(t=[]),this.rows&&this.rows.length>0&&this.cols&&this.cols.length>0){a=new google.visualization.DataTable,a.cols=this.cols;for(var e=0;e<this.cols.length;e++)a.addColumn(this.cols[e]);a.addRows(this.rows)}else t.rows&&t.cols?a=new google.visualization.DataTable(t):t.length>0&&(a=google.visualization.arrayToDataTable(t));return a}})}();</script>
</body></html>